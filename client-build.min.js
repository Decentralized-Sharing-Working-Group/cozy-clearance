require.register("cozy-clearance/contact_autocomplete",function(e,t,n){n.exports=function(e,n,r){var a;return a=t("./contact_collection"),null==r&&(r=function(){return!0}),e.on("keyup",function(){return function(t){return 13!==t.which||e.data("typeahead").shown?void 0:(n(e.val()),e.val(""),t.preventDefault())}}(this)),e.typeahead({source:function(e){var t,n,i;return i=new RegExp(e),t=a.filter(function(e){return e.match(i)}),n=[],t.forEach(function(e){return e.get("emails").forEach(function(t){return n.push({id:e.id,hasPicture:e.get("hasPicture"),display:""+e.get("name")+" &lt;"+t+"&gt;",toString:function(){return""+t+";"+e.id}})})}),n=n.filter(r)},matcher:function(e){var t;return t=$.fn.typeahead.Constructor.prototype.matcher,t.call(this,e.display)},sorter:function(e){var t,n,r,a,i;for(t=[],r=[],n=[];a=e.shift();)i=a.display,i.toLowerCase().indexOf(this.query.toLowerCase())?~i.indexOf(this.query)?r.push(a):n.push(a):t.push(a);return t.concat(r,n)},highlighter:function(e){var t,n;return n=$.fn.typeahead.Constructor.prototype.highlighter,t=e.hasPicture?'<img width="40" src="clearance/contacts/'+e.id+'.jpg">&nbsp;':'<i class="icon icon-user"></i>&nbsp;',t+n.call(this,e.display)},updater:function(){return function(e){return n(e),""}}(this)})}}),require.register("cozy-clearance/contact_collection",function(e,t,n){var r,a,i={}.hasOwnProperty,o=function(e,t){function n(){this.constructor=e}for(var r in t)i.call(t,r)&&(e[r]=t[r]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};a=new Backbone.Collection,a.url="clearance/contacts",a.model=r=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return o(t,e),t.prototype.match=function(e){return e.test(this.get("name"))||this.get("emails").some(function(t){return e.test(t)})},t}(Backbone.Model),a.fetch(),n.exports=a}),require.register("cozy-clearance/modal",function(e,n,r){var a,i={}.hasOwnProperty,o=function(e,t){function n(){this.constructor=e}for(var r in t)i.call(t,r)&&(e[r]=t[r]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};a=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return o(t,e),t.prototype.id="modal-dialog",t.prototype.className="modal fade",t.prototype.initialize=function(e){return null==this.title&&(this.title=e.title),null==this.content&&(this.content=e.content),null==this.yes&&(this.yes=e.yes||"ok"),null==this.no&&(this.no=e.no||"cancel"),null==this.cb&&(this.cb=e.cb||function(){}),this.render(),this.saving=!1,this.$el.modal("show"),this.$el.one("hide.bs.modal",function(e){return function(){return setTimeout(function(){return e.remove()},1e3),e.cb(e.saving)}}(this))},t.prototype.events=function(){return{"click #modal-dialog-no":function(e){return function(){return e.$el.modal("hide")}}(this),"click #modal-dialog-yes":function(e){return function(){return e.saving=!0,e.$el.modal("hide")}}(this)}},t.prototype.render=function(){var e,t,n,r,a,i,o;return t=$('<button class="close" type="button" data-dismiss="modal" aria-hidden="true">Ã—</button>'),i=$('<h4 class="model-title">').text(this.title),a=$('<div class="modal-header">').append(t,i),e=$('<div class="modal-body">').append(this.renderContent()),o=$('<button id="modal-dialog-yes" class="btn btn-cozy">').text(this.yes),r=$('<div class="modal-footer">').append(o),this.no&&r.prepend($('<button id="modal-dialog-no" class="btn btn-link">').text(this.no)),n=$('<div class="modal-content">').append(a,e,r),n=$('<div class="modal-dialog">').append(n),$("body").append(this.$el.append(n))},t.prototype.renderContent=function(){return this.content},t}(Backbone.View),a.alert=function(e,t,n){return new a({title:e,content:t,yes:"ok",no:null,cb:n})},a.confirm=function(e,t,n,r,i){return new a({title:e,content:t,yes:n,no:r,cb:i})},a.error=function(e,n){return new ModalView(t("modal error"),e,t("modal ok"),!1,n)},r.exports=a}),require.register("cozy-clearance/modal_share_template",function(e,t,n){function r(e){var t=[],n=e||{},r=n.t,a=n.type,i=n.model,o=n.clearance,s=n.makeURL,c=n.possible_permissions;return t.push("<p>"+jade.escape(null==(jade.interp=r("modal question "+a+" shareable",{name:i.get("name")}))?"":jade.interp)+'</p><p><button id="share-public" class="button btn-cozy">'+jade.escape(null==(jade.interp=r("public"))?"":jade.interp)+'</button>&nbsp;<button id="share-private" class="button btn-cozy">'+jade.escape(null==(jade.interp=r("private"))?"":jade.interp)+"</button></p>"),"public"==o?t.push("<p>"+jade.escape(null==(jade.interp=r("modal shared "+a+" link msg"))?"":jade.interp)+"</p><input"+jade.attr("value",s(),!0,!1)+' class="form-control"/>'):(t.push("<p>"+jade.escape(null==(jade.interp=r("only you can see"))?"":jade.interp)+'</p><input id="share-input" type="text"'+jade.attr("placeholder",r("modal shared "+a+" custom msg"),!0,!1)+' class="form-control"/><ul id="share-list">'),function(){var e=o;if("number"==typeof e.length)for(var n=0,a=e.length;a>n;n++){var i=e[n],l=i.key;t.push('<li class="clearance-line">'),i.contact?(t.push(i.contact.get("hasPicture")?'<img width="40"'+jade.attr("src","clearance/contacts/"+i.contact.id+".jpg",!0,!1)+"/>&nbsp;":'<img width="40" src="images/defaultpicture.png"/>&nbsp;'),t.push('<span class="clearance-name">'+jade.escape(null==(jade.interp=i.contact.get("name"))?"":jade.interp)+"</span>")):t.push('<span class="clearance-name">'+jade.escape(null==(jade.interp=i.email)?"":jade.interp)+"</span>");var p=Object.keys(c);p.length>1?(t.push("<select"+jade.attr("data-key",l,!0,!1)+' class="changeperm">'),function(){var e=c;if("number"==typeof e.length)for(var n=0,a=e.length;a>n;n++){var o=e[n];t.push("<option"+jade.attr("value",n,!0,!1)+jade.attr("selected",i.perm==n,!0,!1)+">"+jade.escape(null==(jade.interp=" "+r("perm")+r(o))?"":jade.interp)+"</option>")}else{var a=0;for(var n in e){a++;var o=e[n];t.push("<option"+jade.attr("value",n,!0,!1)+jade.attr("selected",i.perm==n,!0,!1)+">"+jade.escape(null==(jade.interp=" "+r("perm")+r(o))?"":jade.interp)+"</option>")}}}.call(this),t.push("</select>")):t.push(jade.escape(null==(jade.interp=" "+r("perm")+c[p[0]])?"":jade.interp)),t.push("<a"+jade.attr("data-key",l,!0,!1)+jade.attr("title",r("revoke"),!0,!1)+' class="clearance-btn pull-right revoke"><i class="icon-remove"></i></a><a'+jade.attr("data-key",l,!0,!1)+jade.attr("title",r("see link"),!0,!1)+jade.attr("href",s(l),!0,!1)+' class="clearance-btn pull-right show-link"><i class="glyphicon glyphicon-link"></i></a></li>')}else{var a=0;for(var n in e){a++;var i=e[n],l=i.key;t.push('<li class="clearance-line">'),i.contact?(t.push(i.contact.get("hasPicture")?'<img width="40"'+jade.attr("src","clearance/contacts/"+i.contact.id+".jpg",!0,!1)+"/>&nbsp;":'<img width="40" src="images/defaultpicture.png"/>&nbsp;'),t.push('<span class="clearance-name">'+jade.escape(null==(jade.interp=i.contact.get("name"))?"":jade.interp)+"</span>")):t.push('<span class="clearance-name">'+jade.escape(null==(jade.interp=i.email)?"":jade.interp)+"</span>");var p=Object.keys(c);p.length>1?(t.push("<select"+jade.attr("data-key",l,!0,!1)+' class="changeperm">'),function(){var e=c;if("number"==typeof e.length)for(var n=0,a=e.length;a>n;n++){var o=e[n];t.push("<option"+jade.attr("value",n,!0,!1)+jade.attr("selected",i.perm==n,!0,!1)+">"+jade.escape(null==(jade.interp=" "+r("perm")+r(o))?"":jade.interp)+"</option>")}else{var a=0;for(var n in e){a++;var o=e[n];t.push("<option"+jade.attr("value",n,!0,!1)+jade.attr("selected",i.perm==n,!0,!1)+">"+jade.escape(null==(jade.interp=" "+r("perm")+r(o))?"":jade.interp)+"</option>")}}}.call(this),t.push("</select>")):t.push(jade.escape(null==(jade.interp=" "+r("perm")+c[p[0]])?"":jade.interp)),t.push("<a"+jade.attr("data-key",l,!0,!1)+jade.attr("title",r("revoke"),!0,!1)+' class="clearance-btn pull-right revoke"><i class="icon-remove"></i></a><a'+jade.attr("data-key",l,!0,!1)+jade.attr("title",r("see link"),!0,!1)+jade.attr("href",s(l),!0,!1)+' class="clearance-btn pull-right show-link"><i class="glyphicon glyphicon-link"></i></a></li>')}}}.call(this),t.push("</ul>")),t.join("")}n.exports=r}),require.register("cozy-clearance/modal_share_view",function(e,n,r){var a,i,o,s,c,l,p,u=function(e,t){return function(){return e.apply(t,arguments)}},d={}.hasOwnProperty,h=function(e,t){function n(){this.constructor=e}for(var r in t)d.call(t,r)&&(e[r]=t[r]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};i=n("./modal"),c=n("./contact_autocomplete"),s=n("./contact_collection"),l=function(e){var t;for(null==e&&(e=32),t="";t.length<e;)t+=Math.random().toString(36).substr(2);return t.substr(0,e)},o=function(e,t){return"public"===e?[]:"public"===t?e:e.filter(function(e){return!_.findWhere(t,{key:e.key})})},p=function(e,t,n,r){var a;return a={method:e,url:t,dataType:"json",data:JSON.stringify(n),contentType:"application/json; charset=utf-8"},$.ajax(_.extend(a,r))},r.exports=a=function(e){function r(){return this.showLink=u(this.showLink,this),this.onClose=u(this.onClose,this),this.revoke=u(this.revoke,this),this.onGuestAdded=u(this.onGuestAdded,this),this.getClearanceWithContacts=u(this.getClearanceWithContacts,this),this.getRenderData=u(this.getRenderData,this),this.typeaheadFilter=u(this.typeaheadFilter,this),this.makeURL=u(this.makeURL,this),r.__super__.constructor.apply(this,arguments)}return h(r,e),r.prototype.template_content=n("./modal_share_template"),r.prototype.events=function(){return _.extend(r.__super__.events.apply(this,arguments),{"click #share-public":"makePublic","click #share-private":"makePrivate","click #modal-dialog-share-save":"onSave","click .revoke":"revoke","click .show-link":"showLink","change select.changeperm":"changePerm"})},r.prototype.permissions=function(){return{r:t("r")}},r.prototype.initialize=function(e){return this.cb=this.onClose,this.model=e.model,this.model.set("clearance",this.model.get("clearance")||[]),this.initState=JSON.parse(JSON.stringify(this.model.get("clearance"))),this.title=t("sharing"),this.yes=t("save"),this.no=t("cancel"),r.__super__.initialize.apply(this,arguments)},r.prototype.makeURL=function(e){var t;return t=this.model.getPublicURL(),e&&(t+="?key="+e),t},r.prototype.makePublic=function(){return"public"!==this.model.get("clearance")?(this.lastPrivate=this.model.get("clearance"),this.model.set({clearance:"public"}),this.refresh()):void 0},r.prototype.makePrivate=function(){return Array.isArray(this.model.get("clearance"))?void 0:(this.model.set({clearance:this.lastPrivate||[]}),this.refresh())},r.prototype.afterRender=function(){var e;return e=this.model.get("clearance")||[],"public"===e?this.$("#share-public").addClass("toggled"):(this.$("#share-private").addClass("toggled"),c(this.$("#share-input"),this.onGuestAdded,this.typeaheadFilter))},r.prototype.renderContent=function(){return $("<p>Please wait</p>")},r.prototype.typeaheadFilter=function(e){return!this.existsEmail(e.toString().split(";")[0])},r.prototype.existsEmail=function(e){return this.model.get("clearance").some(function(t){return t.email===e})},r.prototype.getRenderData=function(){return{type:this.model.get("type"),model:this.model,clearance:this.getClearanceWithContacts(),makeURL:this.makeURL,possible_permissions:this.permissions(),t:t}},r.prototype.getClearanceWithContacts=function(){var e;return e=this.model.get("clearance")||[],"public"===e?"public":e.map(function(e){var t;return t=_.clone(e),t.contactid&&(t.contact=s.get(e.contactid)),t})},r.prototype.refresh=function(){return this.$(".modal-body").html(this.template_content(this.getRenderData())),this.afterRender()},r.prototype.onGuestAdded=function(e){var t,n,r,a,i;return i=e.split(";"),n=i[0],t=i[1],this.existsEmail(n)?null:(r=l(),a="r",this.model.get("clearance").push({email:n,contactid:t,key:r,perm:a}),this.refresh())},r.prototype.revoke=function(e){var t;return t=this.model.get("clearance").filter(function(t){return t.key!==e.currentTarget.dataset.key}),this.model.set({clearance:t}),this.refresh()},r.prototype.changePerm=function(e){var t;return t=e.currentTarget,this.model.get("clearance").filter(function(e){return e.key===t.dataset.key})[0].perm=t.options[t.selectedIndex].value,this.refresh()},r.prototype.onClose=function(e){var n,r;return e?(n=o(this.model.get("clearance"),this.initState),n.length?(r=t("send mails question")+n.map(function(e){return e.email}).join(", "),i.confirm(t("modal send mails"),r,t("yes"),t("no"),function(e){return function(t){return e.doSave(t,n)}}(this))):this.doSave(!1)):this.model.set({clearance:this.initState})},r.prototype.doSave=function(e,t){return p("PUT","clearance/"+this.model.id,this.saveData(),{error:function(){return i.error("server error occured")},success:function(n){return function(){return n.model.trigger("change"),e?p("POST","clearance/"+n.model.id+"/send",t,{error:function(){return i.error("mail not send")},success:function(){return n.$el.modal("hide")}}):n.$el.modal("hide")}}(this)})},r.prototype.saveData=function(){return{clearance:this.model.get("clearance")}},r.prototype.showLink=function(e){var n,r,a,i,o;return r=$(e.target).parents("li"),0===r.find(".linkshow").length?(a=$(e.currentTarget),i=a.prop("href"),r=$('<div class="linkshow">'),n=$("<label>").text(t("copy paste link")),o=$('<input type="text">').val(i),a.parents("li").append(r.append(n,o)),o.focus().select(),e.preventDefault()):r.find(".linkshow").remove(),!1},r}(i)});