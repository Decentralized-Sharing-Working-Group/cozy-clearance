require.register("cozy-clearance/contact_autocomplete",function(t,e,n){var r,i,o={}.hasOwnProperty,a=function(t,e){function n(){this.constructor=t}for(var r in e)o.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};i=new Backbone.Collection,i.url="contacts",i.model=r=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return a(e,t),e.prototype.match=function(t){return t.test(this.get("name"))||this.get("emails").some(function(e){return t.test(e)})},e}(Backbone.Model),i.fetch(),n.exports=function(t,e,n){return null==n&&(n=function(){return!0}),t.on("keyup",function(){return function(n){return 13!==n.which||t.data("typeahead").shown?void 0:(e(t.val()),t.val(""),n.preventDefault())}}(this)),t.typeahead({source:function(t){var e,r,o;return o=new RegExp(t),e=i.filter(function(t){return t.match(o)}),r=[],e.forEach(function(t){return t.get("emails").forEach(function(e){return r.push({id:t.id,display:""+t.get("name")+" &lt;"+e+"&gt;",toString:function(){return""+e+";"+t.id}})})}),r=r.filter(n)},matcher:function(t){var e;return e=$.fn.typeahead.Constructor.prototype.matcher,e.call(this,t.display)},sorter:function(t){var e,n,r,i,o;for(e=[],r=[],n=[];i=t.shift();)o=i.display,o.toLowerCase().indexOf(this.query.toLowerCase())?~o.indexOf(this.query)?r.push(i):n.push(i):e.push(i);return e.concat(r,n)},highlighter:function(t){var e;return e=$.fn.typeahead.Constructor.prototype.highlighter,e.call(this,t.display)},updater:function(){return function(t){return e(t),""}}(this)})}}),require.register("cozy-clearance/modal",function(e,n,r){var i,o={}.hasOwnProperty,a=function(t,e){function n(){this.constructor=t}for(var r in e)o.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};i=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return a(e,t),e.prototype.id="modal-dialog",e.prototype.className="modal fade",e.prototype.initialize=function(t){return null==this.title&&(this.title=t.title),null==this.content&&(this.content=t.content),null==this.yes&&(this.yes=t.yes||"ok"),null==this.no&&(this.no=t.no||"cancel"),null==this.cb&&(this.cb=t.cb||function(){}),this.render(),this.saving=!1,this.$el.modal("show"),this.$el.one("hide.bs.modal",function(t){return function(){return setTimeout(function(){return t.remove()},1e3),t.cb(t.saving)}}(this))},e.prototype.events=function(){return{"click #modal-dialog-no":function(t){return function(){return t.$el.modal("hide")}}(this),"click #modal-dialog-yes":function(t){return function(){return t.saving=!0,t.$el.modal("hide")}}(this)}},e.prototype.render=function(){var t,e,n,r,i,o,a;return e=$('<button class="close" type="button" data-dismiss="modal" aria-hidden="true">Ã—</button>'),o=$('<h4 class="model-title">').text(this.title),i=$('<div class="modal-header">').append(e,o),t=$('<div class="modal-body">').append(this.renderContent()),a=$('<button id="modal-dialog-yes" class="btn btn-cozy">').text(this.yes),r=$('<div class="modal-footer">').append(a),this.no&&r.prepend($('<button id="modal-dialog-no" class="btn btn-link">').text(this.no)),n=$('<div class="modal-content">').append(i,t,r),n=$('<div class="modal-dialog">').append(n),$("body").append(this.$el.append(n))},e.prototype.renderContent=function(){return this.content},e}(Backbone.View),i.alert=function(t,e,n){return new i({title:t,content:e,yes:"ok",no:null,cb:n})},i.confirm=function(t,e,n,r,o){return new i({title:t,content:e,yes:n,no:r,cb:o})},i.error=function(e,n){return new ModalView(t("modal error"),e,t("modal ok"),!1,n)},r.exports=i}),require.register("cozy-clearance/modal_share_template",function(t,e,n){function r(t){var e=[],n=t||{},r=n.t,i=n.type,o=n.model,a=n.clearance,s=n.makeURL;return e.push("<p>"+jade.escape(null==(jade.interp=r("modal question "+i+" shareable",{name:o.get("name")}))?"":jade.interp)+'</p><p><button id="share-public" class="button btn-cozy">'+jade.escape(null==(jade.interp=r("public"))?"":jade.interp)+'</button>&nbsp;<button id="share-private" class="button btn-cozy">'+jade.escape(null==(jade.interp=r("private"))?"":jade.interp)+"</button></p>"),"public"==a?e.push("<p>"+jade.escape(null==(jade.interp=r("modal shared "+i+" link msg"))?"":jade.interp)+"<input"+jade.attr("value",s(),!0,!1)+' class="form-control"/></p>'):(e.push("<p>"+jade.escape(null==(jade.interp=r("only you can see"))?"":jade.interp)+'</p><input id="share-input" type="text"'+jade.attr("placeholder",r("modal shared "+i+" custom msg"),!0,!1)+' class="form-control"/><ul id="share-list">'),function(){var t=a;if("number"==typeof t.length)for(var n=0,i=t.length;i>n;n++){var o=t[n],l=o.key;e.push("<li><a"+jade.attr("data-key",l,!0,!1)+jade.attr("title",r("see link"),!0,!1)+jade.attr("href",s(l),!0,!1)+' class="show-link"><i class="icon-link"></i></a> &nbsp; &nbsp;'+jade.escape(null==(jade.interp=o.email)?"":jade.interp)+"<a"+jade.attr("data-key",l,!0,!1)+jade.attr("title",r("revoke"),!0,!1)+' class="pull-right revoke"><i class="icon-remove"></i></a></li>')}else{var i=0;for(var n in t){i++;var o=t[n],l=o.key;e.push("<li><a"+jade.attr("data-key",l,!0,!1)+jade.attr("title",r("see link"),!0,!1)+jade.attr("href",s(l),!0,!1)+' class="show-link"><i class="icon-link"></i></a> &nbsp; &nbsp;'+jade.escape(null==(jade.interp=o.email)?"":jade.interp)+"<a"+jade.attr("data-key",l,!0,!1)+jade.attr("title",r("revoke"),!0,!1)+' class="pull-right revoke"><i class="icon-remove"></i></a></li>')}}}.call(this),e.push("</ul>")),e.join("")}n.exports=r}),require.register("cozy-clearance/modal_share_view",function(e,n,r){var i,o,a,s,l,c=function(t,e){return function(){return t.apply(e,arguments)}},u={}.hasOwnProperty,p=function(t,e){function n(){this.constructor=t}for(var r in e)u.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};o=n("./modal"),s=n("./contact_autocomplete"),l=function(t){var e;for(null==t&&(t=32),e="";e.length<t;)e+=Math.random().toString(36).substr(2);return e.substr(0,t)},a=function(t,e){return"public"===t?[]:"public"===e?t:t.filter(function(t){return!_.findWhere(e,{key:t.key})})},r.exports=i=function(e){function r(){return this.showLink=c(this.showLink,this),this.onClose=c(this.onClose,this),this.revoke=c(this.revoke,this),this.onGuestAdded=c(this.onGuestAdded,this),this.getRenderData=c(this.getRenderData,this),this.typeaheadFilter=c(this.typeaheadFilter,this),this.makeURL=c(this.makeURL,this),r.__super__.constructor.apply(this,arguments)}return p(r,e),r.prototype.template_content=n("./modal_share_template"),r.prototype.events=function(){return _.extend(r.__super__.events.apply(this,arguments),{"click #share-public":"makePublic","click #share-private":"makePrivate","click #modal-dialog-share-save":"onSave","click .revoke":"revoke","click .show-link":"showLink"})},r.prototype.initialize=function(e){return this.cb=this.onClose,this.model=e.model,this.model.set("clearance",this.model.get("clearance")||[]),this.initState=JSON.parse(JSON.stringify(this.model.get("clearance"))),this.title=t("sharing"),this.yes=t("save"),this.no=t("cancel"),r.__super__.initialize.apply(this,arguments)},r.prototype.makeURL=function(t){var e;return e=this.model.getPublicURL(),t&&(e+="?key="+t),e},r.prototype.makePublic=function(){return this.forcedPublic||"public"===this.model.get("clearance")?void 0:(this.lastPrivate=this.model.get("clearance"),this.model.set({clearance:"public"}),this.refresh())},r.prototype.makePrivate=function(){return Array.isArray(this.model.get("clearance"))?void 0:(this.model.set({clearance:this.lastPrivate||[]}),this.refresh())},r.prototype.afterRender=function(){var t;return t=this.model.get("clearance")||[],this.forcedPublic||"public"===t?this.$("#share-public").addClass("toggled"):(this.$("#share-private").addClass("toggled"),s(this.$("#share-input"),this.onGuestAdded,this.typeaheadFilter))},r.prototype.renderContent=function(){return $("<p>Please wait</p>")},r.prototype.typeaheadFilter=function(t){return!this.existsEmail(t.toString().split(";")[0])},r.prototype.existsEmail=function(t){return this.model.get("clearance").some(function(e){return e.email===t})},r.prototype.getRenderData=function(){return{type:this.model.get("type"),model:this.model,clearance:this.model.get("clearance"),makeURL:this.makeURL,t:t}},r.prototype.refresh=function(t){return t&&this.model.set(t),this.$(".modal-body").html(this.template_content(this.getRenderData())),this.afterRender()},r.prototype.onGuestAdded=function(t){var e,n,r,i,o;return o=t.split(";"),n=o[0],e=o[1],this.existsEmail(n)?null:(r=l(),i="r",this.model.get("clearance").push({email:n,contactid:e,key:r,perm:i}),this.refresh())},r.prototype.revoke=function(t){var e;return e=this.model.get("clearance").filter(function(e){return e.key!==t.currentTarget.dataset.key}),this.model.set({clearance:e}),this.refresh()},r.prototype.onClose=function(e){var n,r;return e?(n=a(this.model.get("clearance"),this.initState),n.length?(r=t("send mails question")+n.map(function(t){return t.email}).join(", "),o.confirm(t("modal send mails"),r,t("yes"),t("no"),function(t){return function(e){return t.doSave(e,n)}}(this))):this.doSave(!1)):this.model.set({clearance:this.initState})},r.prototype.showLink=function(e){var n,r,i,o,a;return i=$(e.currentTarget),o=i.prop("href"),r=$('<div class="linkshow">'),n=$("<label>").text(t("copy paste link")),a=$('<input type="text">').val(o).blur(function(){return r.remove()}),i.parents("li").append(r.append(n,a)),a.focus().select(),e.preventDefault(),!1},r}(o)});